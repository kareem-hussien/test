<!-- Connection Status -->
<div class="col-lg-4 mb-4">
    <div class="dashboard-card">
        <h4 class="mb-4">Connection Status</h4>
        
        <!-- Gold Club Badge -->
        {% if user_profile.is_gold_member %}
        <div class="position-absolute top-0 end-0 m-3">
            <span class="badge bg-warning text-dark p-2" data-bs-toggle="tooltip" title="Gold Club Member">
                <i class="bi bi-stars me-1"></i> Gold Club
            </span>
        </div>
        {% endif %}
        
        <div class="mb-3">
            <label class="form-label">Last Connection</label>
            <div class="d-flex align-items-center">
                <i class="bi bi-clock me-2 text-muted"></i>
                <span>{{ user_profile.last_connection }}</span>
            </div>
        </div>
        
        <div class="mb-3">
            <label class="form-label">Status</label>
            <div class="d-flex align-items-center">
                {% if user_profile.connection_verified %}
                    <span class="badge bg-success me-2">Connected</span>
                    <span>Your account is connected and working</span>
                {% elif user_profile.travian_credentials.username and user_profile.travian_credentials.password %}
                    <span class="badge bg-primary me-2">Ready</span>
                    <span>Your credentials are set up</span>
                {% else %}
                    <span class="badge bg-warning me-2">Not Configured</span>
                    <span>Please set up your Travian credentials</span>
                {% endif %}
            </div>
        </div>

        <!-- Disconnect Account button -->
        <div class="mt-3">
            {% if user_profile.travian_credentials.username %}
            <form action="{{ url_for('user.disconnect_travian') }}" method="post" id="disconnectForm">
                {% if csrf_token %}
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                {% endif %}
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#disconnectModal">
                    <i class="bi bi-x-circle me-2"></i>Disconnect Account
                </button>
            </form>
            {% endif %}
        </div>

        <!-- Disconnect Confirmation Modal -->
        <div class="modal fade" id="disconnectModal" tabindex="-1" aria-labelledby="disconnectModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="disconnectModalLabel">Disconnect Travian Account</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to disconnect your Travian account?</p>
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <strong>Warning:</strong> This will remove all your Travian credentials and village data from our system. You'll need to set up your account again to use automation features.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmDisconnect">Disconnect</button>
                    </div>
                </div>
            </div>
        </div>

      
        {% if user_profile.connection_verified %}
        <div class="alert alert-success mt-3">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Account connected!</strong> Last verified: {{ user_profile.last_connection }}
            {% if user_profile.villages_count %}
            <div class="mt-2">
                <i class="bi bi-buildings me-2"></i>
                <strong>{{ user_profile.villages_count }}</strong> {% if user_profile.villages_count == 1 %}village{% else %}villages{% endif %} detected in your account
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Gold Club Status Alert -->
        {% if user_profile.connection_verified %}
            {% if user_profile.is_gold_member %}
            <div class="alert alert-warning mt-3">
                <i class="bi bi-stars me-2"></i>
                <strong>Gold Club Membership Confirmed!</strong> Enhanced features are available.
            </div>
            {% else %}
            <div class="alert alert-secondary mt-3">
                <i class="bi bi-info-circle-fill me-2"></i>
                You are not a Gold Club member. Some premium features may be unavailable.
            </div>
            {% endif %}
        {% endif %}
        
        <div class="alert alert-info mt-3">
            <i class="bi bi-info-circle-fill me-2"></i>
            <span>These settings are required for automation features like Auto Farm and Troop Training to work.</span>
        </div>
        
        <div class="mt-4">
            <a href="{{ url_for('user.villages') }}" class="btn btn-outline-primary">
                <i class="bi bi-buildings me-2"></i>Manage Villages
            </a>
        </div>
    </div>
</div>